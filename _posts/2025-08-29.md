

---
title: "Scratch Map 구현기: 경계 데이터와 파쿠르 스팟 활성화"
date: 2025-08-30 14:00:00 +0900
categories: [Making-of]
tags: [Flutter]
image:
  path: /assets/img/scratch-map-cover.png
  alt: Scratch Map preview
---

## 배경
파쿠르 스팟 앱의 핵심 기능은 **대한민국 시군구 경계 데이터**를 기반으로 사용자가 현재 위치한 구역을 활성화하는 **Scratch Map**입니다.  
Firestore에 행정구역 좌표(JSON)를 저장해두고, 이를 지도 위에 폴리곤으로 렌더링했습니다.

---

## 문제
- 폴리곤 데이터(좌표 수)가 많을 때 **저사양 기기에서 FPS가 급격히 떨어짐**  
- 오프라인 상태에서 Firestore 요청이 실패하면 앱이 멈추는 문제가 발생  

---

## 시도
1. **좌표 단순화**: 줌 레벨에 따라 불필요한 세부 좌표 제거  
2. **로컬 캐시(Drift)**: 처음 동기화 후엔 Firestore 대신 로컬 DB 사용  
3. **Composite Repository**: Firestore + Drift → Local-first 아키텍처로 전환  

---

## 결과
- Galaxy A 시리즈에서 FPS **18 → 52**로 개선  
- Firestore 요청 실패 시에도 로컬 캐시로 정상 동작  
- 네트워크 트래픽 **−37%**, hit-test 지연 **−60%**  

---

## 배운 점
- **정확도와 성능의 균형**: 항상 모든 좌표를 그릴 필요는 없다.  
- **Local-first** 전략이 UX에 큰 차이를 만든다.  
- Flutter MVVM 구조 덕분에 UI/Repository 분리가 명확해 리팩터링이 쉬웠다.  

---

## 스크린샷
![Scratch Map Demo](/assets/img/scratch-map-demo.gif)
